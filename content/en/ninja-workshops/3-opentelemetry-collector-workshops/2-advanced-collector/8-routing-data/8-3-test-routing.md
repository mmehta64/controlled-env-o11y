---
title: 8.3 Test Routing Connector
linkTitle: 8.3 Test Routing Connector
weight: 3
---

{{% notice title="Exercise" style="green" icon="running" %}}

In this section, we will test the `routing` rule configured for the **Gateway**. The expected result is that the`span` generated by the `loadgen` will be sent to the `gateway-traces-security.out` file.

**Start the Gateway**: In your **Gateway terminal** window start the `gateway`.

```bash
../otelcol --config gateway.yaml
```

**Start the Agent**: In your **Agent terminal** window start the `agent`.

```bash
../otelcol --config agent.yaml
```

**Send a Regular Span**: In the **Spans terminal** window send a regular span using the `loadgen`:

```bash
../loadgen -count 1
```

Both the `agent` and `gateway` will display debug information. The gateway will also generate a new `gateway-traces-standard.out` file, as this is now the designated destination for regular spans.

{{% notice title="Tip" style="primary" icon="lightbulb" %}}
If you check `gateway-traces-standard.out`, it will contain the `span` sent by `loadgen`. You will also see an empty `gateway-traces-security.out` file, as the routing configuration creates output files immediately, even if no matching spans have been processed yet.
{{% /notice %}}

**Send a Security Span**: In the **Spans terminal** window send a security span using the `security` flag:

```bash
../loadgen -security -count 1
```

Again, both the `agent` and `gateway` should display debug information, including the span you just sent. This time, the `gateway` will write a line to the `gateway-traces-security.out` file, which is designated for spans where the `deployment.environment` resource attribute matches `"security-applications"`.
The `gateway-traces-standard.out` should be unchanged.

{{% tabs %}}
{{% tab title="Validate resource attribute matches" %}}

```bash
jq -c '.resourceSpans[] as $resource | $resource.scopeSpans[].spans[] | {spanId: .spanId, deploymentEnvironment: ($resource.resource.attributes[] | select(.key == "deployment.environment") | .value.stringValue)}' gateway-traces-security.out
```

{{% /tabs %}}
{{% tab title="Output" %}}

```json
{"spanId":"cb799e92e26d5782","deploymentEnvironment":"security-applications"}
```

{{% /tab %}}
{{% /tabs %}}

You can repeat this scenario multiple times, and each trace will be written to its corresponding output file.

> [!IMPORTANT]
> Stop the `agent` and the `gateway` processes by pressing `Ctrl-C` in their respective terminals.

{{% /notice %}}

## Conclusion

In this section, we successfully tested the routing connector in the gateway by sending different spans and verifying their destinations.

- **Regular spans** were correctly routed to `gateway-traces-standard.out`, confirming that spans without a matching `deployment.environment` attribute follow the default pipeline.

- **Security-related spans** were routed to `gateway-traces-security.out`, demonstrating that the routing rule based on `"deployment.environment": "security-applications"` works as expected.

By inspecting the output files, we confirmed that the OpenTelemetry Collector *correctly evaluates span attributes and routes them to the appropriate destinations*. This validates that routing rules can effectively separate and direct telemetry data for different use cases.

You can now extend this approach by defining additional routing rules to further categorize spans, metrics, and logs based on different attributes.
